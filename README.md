# cask

Git commit helper that generates commit messages from staged diffs with Gemini
and appends an AI code percentage. If the AI percentage is above the threshold,
the subject line is prefixed with `CRUCIAL:`.

## Requirements

- Python 3
- Git
- Gemini API key

## Install

```sh
./install.sh
```

To install to a different prefix (example: `/usr/local`):

```sh
./install.sh /usr/local
```

This installs:

- `cask` to `$prefix/bin/cask`
- a global `commit-msg` hook at `~/.config/git/hooks/commit-msg`
- sets `git config --global core.hooksPath` to that hooks directory

If you already use `core.hooksPath`, set `CASK_FORCE=1` to override or install
the hook manually.

## Usage

Generate a commit message from staged changes:

```sh
cask generate
```

The git hook runs automatically on `git commit` and updates the message.
If a message already exists, cask keeps it and appends the AI percent footer.

## Environment variables

- `CASK_GEMINI_API_KEY` or `GEMINI_API_KEY` (required for Gemini)
- `CASK_GEMINI_MODEL` (default: `gemini-1.5-pro`)
- `CASK_CRUCIAL_THRESHOLD` (default: `50`)
- `CASK_AI_PERCENT` (override heuristic, `0-100`)
- `CASK_MAX_DIFF_CHARS` (default: `12000`)
- `CASK_REQUIRE_GEMINI` (`1` to fail if Gemini is unavailable)

## AI percentage heuristic

cask counts added lines in the staged diff and marks a line as AI-generated if:

- it matches common AI or generation markers (e.g. `@generated`, `generated by`)
- the file path matches common generated/codegen patterns

You can override the percent via `CASK_AI_PERCENT` or `--ai-percent`.
